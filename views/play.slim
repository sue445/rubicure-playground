html
  head
    title rubicure-playground
    script src="https://code.jquery.com/jquery-3.7.0.min.js"
  body
    css:
      #input {
        width: 100%;
      }

      #output {
        width: 100%;
        overflow: auto;
      }

    button#run Run
    textarea#input rows=10
    textarea#output rows=10 readonly=true

  javascript:
    function printWithDelay(text, delay) {
      return new Promise((resolve) => {
        setTimeout(() => {
          let output = $("#output").val();
          output += text + "\n"
          $("#output").val(output);

          // Scroll to bottom
          const pos = $("#output")[0].scrollHeight;
          $("#output").scrollTop(pos);

          resolve();
        }, delay);
      });
    }

    async function printLinesWithDelay(lines, delay) {
      for (let i = 0; i < lines.length; i++) {
        if (lines[i].length > 0) {
          await printWithDelay(lines[i], delay);
        }
      }
    }

    $("#run").click(() => {
      $.ajax({
        url: "/run",
        type: "POST",
        dataType: "json",
        data: {
          input: $("#input").val()
        }
      }).done((data) => {
        $("#output").val("");
        const lines = data.output.split('\n');
        printLinesWithDelay(lines, 1000);
      })
    })
